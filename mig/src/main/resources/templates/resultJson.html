<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>處理結果 - XSD Schema JSON 修改器</title>
    <style nonce="bkZ0dkFwMjAyNA==">
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .layout {
            display: flex;
            gap: 2rem;
        }
        
        .sidebar {
            width: 240px;
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            height: fit-content;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .sidebar-header h4 {
            font-size: 0.875rem;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 0.5rem;
        }
        
        .sidebar-menu a {
            display: block;
            padding: 0.75rem 1rem;
            color: #333;
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .sidebar-menu a:hover {
            background: #f5f5f5;
        }
        
        .container {
            flex: 1;
            max-width: 1200px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 2rem;
        }
        
        h1 {
            color: #333;
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .success-badge {
            display: inline-block;
            background: #f0f9f4;
            border: 1px solid #34d399;
            color: #065f46;
            padding: 0.75rem 1.25rem;
            border-radius: 4px;
            margin-bottom: 2rem;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .file-info {
            background: #fafafa;
            border: 1px solid #e5e5e5;
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            color: #333;
        }
        
        .file-info strong {
            font-weight: 600;
        }
        
        .actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            flex: 1;
            text-decoration: none;
            text-align: center;
        }
        
        .btn-primary {
            background: #333;
            color: white;
        }
        
        .btn-primary:hover {
            background: #555;
        }
        
        .btn-secondary {
            background: #e5e5e5;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #d4d4d4;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .panel {
            background: #fafafa;
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid #e5e5e5;
        }
        
        .panel h3 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .json-viewer {
            background: #2d2d2d;
            color: #f5f5f5;
            padding: 1.5rem;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            line-height: 1.6;
            cursor: pointer;
            position: relative;
        }
        
        .json-viewer:hover::after {
            content: '點選複製';
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            color: #333;
            padding: 0.25rem 0.75rem;
            border-radius: 3px;
            font-size: 0.75rem;
        }
        
        .highlight {
            background: rgba(255,215,0,0.2);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
        }
        
        @media (max-width: 768px) {
            .layout {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .comparison {
                grid-template-columns: 1fr;
            }
            
            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<div class="layout">
    <!-- 側邊欄 -->
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>


    <div class="container">
        <h1>處理成功</h1>
        
        <div class="success-badge">
            已成功添加 LimitDateTime2 元素到 AdditionalInformation 中
        </div>
        
        <div class="file-info">
            <strong>原始文件：</strong><span th:text="${fileName}">example.json</span>
        </div>
        
        <div class="actions">
            <button onclick="downloadModifiedJson()" class="btn btn-primary">
                下載修改後的 JSON
            </button>
            
            <a href="/json/" class="btn btn-secondary">
                處理另一個文件
            </a>
        </div>
        
        <div class="comparison">
            <div class="panel">
                <h3>原始 JSON</h3>
                <div class="json-viewer" onclick="copyToClipboard(this)">
                    <pre th:text="${#strings.length(originalJson) > 5000 ? #strings.substring(originalJson, 0, 5000) + '...' : originalJson}"></pre>
                </div>
            </div>
            
            <div class="panel">
                <h3>修改後的 JSON</h3>
                <div class="json-viewer" onclick="copyToClipboard(this)">
                    <pre th:text="${#strings.length(modifiedJson) > 5000 ? #strings.substring(modifiedJson, 0, 5000) + '...' : modifiedJson}"></pre>
                </div>
            </div>
        </div>
        
        <div class="panel" style="margin-top: 1.5rem;">
            <h3>新增的元素詳情</h3>
            <div class="json-viewer">
                <pre>{
  "@name": "TW_LimitDateTime2",
  "@type": "ds:AdditionalInformation2LimitDateTime2Type",
  "xsd:annotation": {
    "xsd:documentation": {
      "@xml:lang": "en",
      "ccts:UniqueID": "TW",
      "ccts:DictionaryEntryName": "Additional Information2. Limit2. Date Time",
      "ccts:Definition": "Date and time by when the event has to be completed2.",
      "ccts:Cardinality": "1",
      "ccts:ObjectClassTerm": "Additional Information2",
      "ccts:PropertyTerm": "Limit2",
      "ccts:RepresentationTerm": "Date Time",
      <span class="highlight">"tsw:ChineseName": "補辦期限2"</span>,
      "tsw:Remark": {},
      "tsw:Format": "an8"
    }
  }
}</pre>
            </div>
        </div>
    </div>
</div>
    
<textarea id="modifiedJsonData" style="display:none;" th:text="${modifiedJson}"></textarea>

<script nonce="bkZ0dkFwMjAyNA==">
function copyToClipboard(element) {
    const text = element.textContent;
    navigator.clipboard.writeText(text).then(() => {
        const originalBg = element.style.background;
        element.style.background = '#4a4a4a';
        setTimeout(() => {
            element.style.background = originalBg;
        }, 300);
    }).catch(err => {
        console.error('複製失敗:', err);
        alert('複製失敗，請手動複製');
    });
}

function downloadModifiedJson() {
    try {
        const modifiedJson = document.getElementById('modifiedJsonData').value;
        const blob = new Blob([modifiedJson], { type: 'application/json' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'N5107' + '.json';
        
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
    } catch (error) {
        console.error('下載失敗:', error);
        alert('下載發生錯誤：' + error.message);
    }
}
</script>
</body>
</html>